
<style>
  /* Question Container - Clean shadcn style */
/* Question Container - Clean shadcn style */
.question-container {
    background-color: #ffffff;
    border: 1px solid #e4e4e7;
    border-radius: 8px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
    transition: all 0.2s ease-in-out;
}

.question-container:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

/* Question Type Badge */
.question-type {
    display: inline-block;
    font-size: 12px;
    font-weight: 500;
    color: #6366f1;
    background-color: #eef2ff;
    padding: 4px 8px;
    border-radius: 4px;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

/* Question Title */
.question-title {
    font-size: 18px;
    font-weight: 600;
    color: #09090b;
    margin-bottom: 8px;
    line-height: 1.4;
}

/* Question Text */
.question-text {
    font-size: 14px;
    color: #52525b;
    line-height: 1.6;
    margin-bottom: 20px;
}

/* Options Container */
.options-container {
    margin-bottom: 20px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

/* Individual Option */
.option {
    display: flex;
    align-items: center;
    height: 32px;
    padding: 0 8px;
    border-radius: 6px;
    border: 1px solid #e4e4e7;
    transition: all 0.15s ease-in-out;
    cursor: pointer;
    position: relative;
}

.option:hover {
    background-color: #f4f4f5;
}

.option:has(input:checked) {
    background-color: #f0f9ff;
    border: 1px solid #0ea5e9;
}

/* Checkbox Styling */
.option input[type="checkbox"] {
    width: 16px;
    height: 16px;
    margin: 0;
    margin-right: 12px;
    appearance: none;
    border: 2px solid #d4d4d8;
    border-radius: 3px;
    background-color: #ffffff;
    cursor: pointer;
    transition: all 0.15s ease-in-out;
    position: relative;
    flex-shrink: 0;
}

.option input[type="checkbox"]:hover {
    border-color: #a1a1aa;
}

.option input[type="checkbox"]:checked {
    background-color: #0ea5e9;
    border-color: #0ea5e9;
}

.option input[type="checkbox"]:checked::after {
    content: '';
    position: absolute;
    left: 2px;
    top: -1px;
    width: 4px;
    height: 8px;
    border: 2px solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
}

.option input[type="checkbox"]:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

/* Option Label */
.option label {
    font-size: 14px;
    color: #27272a;
    cursor: pointer;
    line-height: 1.4;
    flex: 1;
    transition: color 0.15s ease-in-out;
}

.option:has(input:disabled) label {
    cursor: not-allowed;
}

/* Explanation Textarea */
.explanation-area {
    width: 100%;
    height: 120px;
    padding: 12px;
    border: 1px solid #e4e4e7;
    border-radius: 6px;
    font-size: 14px;
    line-height: 1.5;
    color: #27272a;
    background-color: #ffffff;
    resize: vertical;
    transition: all 0.15s ease-in-out;
    margin-bottom: 20px;
    font-family: inherit;
}

.explanation-area:focus {
    outline: none;
    border-color: #0ea5e9;
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
}

.explanation-area::placeholder {
    color: #a1a1aa;
}

/* Show/Hide Button */
.latest-button-container {
    display: inline-flex;
    align-items: center;
    height: 32px;
    border-radius: 6px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.15s ease-in-out;
    border: 1px solid #e4e4e7;
    background-color: #ffffff;
}

.latest-button-container:hover {
    border-color: #d4d4d8;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
}

.latest-button-container:active {
    transform: translateY(1px);
}

.latest-button {
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: transparent;
    color: #27272a;
    text-decoration: none;
    border: none;
    padding: 0 12px;
    height: 100%;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.025em;
    transition: all 0.15s ease-in-out;
}

.arrow-container {
    background-color: #f4f4f5;
    width: 32px;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: all 0.15s ease-in-out;
    border-left: 1px solid #e4e4e7;
}

.arrow {
    width: 12px;
    height: 12px;
    fill: #71717a;
    transition: all 0.15s ease-in-out;
}

.latest-button-container:hover .latest-button {
    background-color: #f9fafb;
    color: #18181b;
}

.latest-button-container:hover .arrow-container {
    background-color: #e4e4e7;
}

.latest-button-container:hover .arrow {
    fill: #27272a;
}

/* Answer States */
.correct-answer {
    color: #16a34a !important;
    font-weight: 500;
}

.incorrect-answer {
    color: #dc2626 !important;
    text-decoration: line-through;
    opacity: 0.7;
}

.check-mark {
    color: #16a34a;
    font-weight: 600;
    margin-left: 4px;
}

.x-mark {
    color: #dc2626;
    font-weight: 600;
    margin-left: 4px;
}

/* Solution Container */
.solution-container {
    margin-top: 16px;
    padding: 16px;
    background-color: #f0fdf4;
    border: 1px solid #bbf7d0;
    border-radius: 6px;
    border-left: 4px solid #16a34a;
}

.solution-container h4 {
    margin: 0 0 8px 0;
    font-size: 14px;
    font-weight: 600;
    color: #15803d;
}

.solution-text {
    font-size: 14px;
    color: #166534;
    line-height: 1.5;
    margin: 0;
}

/* Focus states for accessibility */
.option input[type="checkbox"]:focus-visible {
    outline: 2px solid #0ea5e9;
    outline-offset: 2px;
}

.latest-button-container:focus-visible {
    outline: 2px solid #0ea5e9;
    outline-offset: 2px;
}

/* Responsive adjustments */
@media (max-width: 640px) {
    .question-container {
        padding: 16px;
        margin-bottom: 16px;
    }
    
    .latest-button-container {
        width: 100%;
        justify-content: space-between;
    }
    
    .latest-button {
        flex: 1;
    }
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {

    function createShowButton() {
      const buttonContainer = document.createElement('div');
      buttonContainer.className = 'latest-button-container';
      
      const button = document.createElement('div');
      button.className = 'latest-button';
      button.textContent = 'SHOW ANSWER';
      button.dataset.state = 'hidden'; // Track button state: hidden or shown
      
      // Add click event listener to toggle answers
      button.addEventListener('click', function(e) {
        const questionContainer = this.closest('.question-container');
        if (questionContainer) {
          const state = this.dataset.state;
          
          if (state === 'hidden') {
            showAnswer(questionContainer);
            this.textContent = 'HIDE ANSWER';
            this.dataset.state = 'shown';
          } else {
            hideAnswer(questionContainer);
            this.textContent = 'SHOW ANSWER';
            this.dataset.state = 'hidden';
          }
        }
      });
      
      buttonContainer.appendChild(button);
      
      const arrowContainer = document.createElement('div');
      arrowContainer.className = 'arrow-container';
      
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
      svg.setAttribute('width', '16');
      svg.setAttribute('height', '16');
      svg.setAttribute('fill', 'white');
      svg.setAttribute('stroke', 'white');
      svg.setAttribute('class', 'arrow');
      svg.setAttribute('viewBox', '0 0 16 16');
      
      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      path.setAttribute('fill-rule', 'evenodd');
      path.setAttribute('d', 'M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708');
      svg.appendChild(path);
      
      arrowContainer.appendChild(svg);
      buttonContainer.appendChild(arrowContainer);
      
      return buttonContainer;
    }
    
    // Function to show answers when button is clicked
    function showAnswer(questionContainer) {
      const questionType = questionContainer.querySelector('.question-type').textContent;
      
      if (questionType === 'Single-Choice') {
        // Get the block ID to find the corresponding data
        const blockId = questionContainer.dataset.blockId;
        
        // Find the corresponding block data
        const blockData = findBlockDataById(blockId);
        if (!blockData) return;
        
        // Mark correct and incorrect answers
        const options = questionContainer.querySelectorAll('.option');
        
        options.forEach((option, index) => {
          const input = option.querySelector('input');
          const label = option.querySelector('label');
          const isCorrect = blockData.data.options[index].selected;
          
          // Store original state for hiding later
          if (!option.dataset.originalState) {
            option.dataset.originalState = JSON.stringify({
              checked: input.checked,
              disabled: input.disabled
            });
          }
          
          // Mark as correct or incorrect
          if (isCorrect) {
            label.classList.add('correct-answer');
            if (!label.querySelector('.check-mark')) {
              label.insertAdjacentHTML('beforeend', ' <span class="check-mark">✓</span>');
            }
          } else if (input.checked && !isCorrect) {
            label.classList.add('incorrect-answer');
            if (!label.querySelector('.x-mark')) {
              label.insertAdjacentHTML('beforeend', ' <span class="x-mark">✗</span>');
            }
          }
          
          // Disable inputs after showing answer
          input.disabled = true;
        });
        
        // Add a class to the container to mark it as showing answers
        questionContainer.classList.add('showing-answers');
      } 
      else if (questionType === 'Explanation') {
        // Get the block ID to find the corresponding data
        const blockId = questionContainer.dataset.blockId;
        
        // Find the corresponding block data
        const blockData = findBlockDataById(blockId);
        if (!blockData) return;
        
        // Save the current textarea content if it doesn't exist yet
        const textarea = questionContainer.querySelector('.explanation-area');
        if (textarea && !textarea.dataset.savedContent) {
          textarea.dataset.savedContent = textarea.value;
        }
        
        // Show the solution
        let solutionDiv = questionContainer.querySelector('.solution-container');
        if (!solutionDiv) {
          solutionDiv = document.createElement('div');
          solutionDiv.className = 'solution-container';
          solutionDiv.innerHTML = `
            <h4>Solution:</h4>
            <div class="solution-text">${blockData.data.solution}</div>
          `;
          
          // Replace textarea with solution or add solution below
          if (textarea) {
            textarea.style.display = 'none';
            questionContainer.insertBefore(solutionDiv, textarea.nextSibling);
          } else {
            questionContainer.appendChild(solutionDiv);
          }
        } else {
          // If solution exists but was hidden, show it
          solutionDiv.style.display = '';
          if (textarea) {
            textarea.style.display = 'none';
          }
        }
        
        // Add a class to the container to mark it as showing answers
        questionContainer.classList.add('showing-answers');
      }
    }
    
    // Function to hide answers
    function hideAnswer(questionContainer) {
      const questionType = questionContainer.querySelector('.question-type').textContent;
      
      if (questionType === 'Single-Choice') {
        // Restore original state of options
        const options = questionContainer.querySelectorAll('.option');
        
        options.forEach(option => {
          const input = option.querySelector('input');
          const label = option.querySelector('label');
          
          // Remove answer markings
          label.classList.remove('correct-answer', 'incorrect-answer');
          
          // Remove check/x marks
          const checkMark = label.querySelector('.check-mark');
          if (checkMark) {
            checkMark.remove();
          }
          
          const xMark = label.querySelector('.x-mark');
          if (xMark) {
            xMark.remove();
          }
          
          // Restore original state
          if (option.dataset.originalState) {
            const originalState = JSON.parse(option.dataset.originalState);
            input.checked = originalState.checked;
            input.disabled = originalState.disabled;
          }
        });
        
        // Remove the showing-answers class
        questionContainer.classList.remove('showing-answers');
      } 
      else if (questionType === 'Explanation') {
        // Hide solution
        const solutionDiv = questionContainer.querySelector('.solution-container');
        if (solutionDiv) {
          solutionDiv.style.display = 'none';
        }
        
        // Show textarea
        const textarea = questionContainer.querySelector('.explanation-area');
        if (textarea) {
          textarea.style.display = '';
          
          // Restore saved content if it exists
          if (textarea.dataset.savedContent) {
            textarea.value = textarea.dataset.savedContent;
          }
        }
        
        // Remove the showing-answers class
        questionContainer.classList.remove('showing-answers');
      }
    }
    
    // Helper function to find block data by ID
    function findBlockDataById(blockId) {
      if (!window.noteData || !window.noteData.blocks) return null;
      
      return window.noteData.blocks.find(block => block.id === blockId);
    }
    
    try {
      // Get the note content from a data attribute that we'll create in the HTML
      const noteContent = document.getElementById('note-content-data').textContent;
      const noteData = JSON.parse(noteContent);
      
      // Store noteData globally to access it when showing answers
      window.noteData = noteData;
      
      // Function to render the note content
      function renderNote(data) {
        const contentElement = document.getElementById('note-content');
        const timestampElement = document.getElementById('note-timestamp');
        
        // Render blocks
        data.blocks.forEach(block => {
          const blockElement = renderBlock(block);
          if (blockElement) {
            contentElement.appendChild(blockElement);
          }
        });
      }
      
      // Function to render individual blocks
      function renderBlock(block) {
        switch(block.type) {
          case 'header':
            const header = document.createElement(`h${block.data.level}`);
            header.innerHTML = block.data.text;
            return header;
            
          case 'paragraph':
            const paragraph = document.createElement('p');
            paragraph.innerHTML = block.data.text;
            return paragraph;
            
          case 'alert':
            const alert = document.createElement('div');
            alert.className = `alert alert-${block.data.type}`;
            alert.textContent = block.data.message;
            return alert;
            
          case 'list':
            if (block.data.style === 'checklist') {
              const list = document.createElement('ul');
              list.className = 'checklist';
              
              block.data.items.forEach(item => {
                const listItem = document.createElement('li');
                listItem.className = 'checklist-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = item.meta.checked;
                checkbox.disabled = true;
                
                const label = document.createElement('span');
                label.innerHTML = item.content;
                
                listItem.appendChild(checkbox);
                listItem.appendChild(label);
                list.appendChild(listItem);
              });
              
              return list;
            } else {
              const list = document.createElement(block.data.style === 'ordered' ? 'ol' : 'ul');
              
              block.data.items.forEach(item => {
                const listItem = document.createElement('li');
                listItem.innerHTML = item.content;
                list.appendChild(listItem);
              });
              
              return list;
            }
            
          case 'table':
            const table = document.createElement('table');
            
            block.data.content.forEach((row, rowIndex) => {
              const tr = document.createElement('tr');
              
              row.forEach((cell, cellIndex) => {
                const cellElement = document.createElement(
                  block.data.withHeadings && rowIndex === 0 ? 'th' : 'td'
                );
                cellElement.textContent = cell;
                tr.appendChild(cellElement);
              });
              
              table.appendChild(tr);
            });
            
            return table;
          
          case 'multipleChoise':
            const multipleChoise = document.createElement('div');
            multipleChoise.className = 'question-container';
            multipleChoise.dataset.blockId = block.id; // Store block ID for later reference
            
            // Frage-Typ hinzufügen
            const questionType = document.createElement('div');
            questionType.className = 'question-type';
            questionType.textContent = 'Single-Choice';
            multipleChoise.appendChild(questionType);
            
            // Frage-Titel hinzufügen
            const questionTitle = document.createElement('div');
            questionTitle.className = 'question-title';
            questionTitle.textContent = 'Frage 1';
            multipleChoise.appendChild(questionTitle);
            
            // Fragetext hinzufügen
            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            questionText.textContent = block.data.question;
            multipleChoise.appendChild(questionText);
            
            // Optionen-Container erstellen
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';
            const options = block.data.options.map((option, index) => {
              return {
                id: `q1-opt${index+1}`, 
                value: option.text.toLowerCase().replace(/\s+/g, '-'),
                label: option.text
              };
            });
            
            options.forEach(option => {
              const optionDiv = document.createElement('div');
              optionDiv.className = 'option';
              
              const input = document.createElement('input');
              input.type = 'checkbox';
              input.id = option.id;
              input.name = 'question1';
              input.value = option.value;
              
              const label = document.createElement('label');
              label.setAttribute('for', option.id);
              label.textContent = option.label;
              
              optionDiv.appendChild(input);
              optionDiv.appendChild(label);
              optionsContainer.appendChild(optionDiv);
            });
            
            multipleChoise.appendChild(optionsContainer);
            
            // Button-Container hinzufügen
            multipleChoise.appendChild(createShowButton());

            return multipleChoise;
          
          case 'explanation':
            const explanation = document.createElement('div');
            explanation.className = 'question-container';
            explanation.dataset.blockId = block.id; // Store block ID for later reference
            
            // Frage-Typ hinzufügen
            const questionTypeExplanation = document.createElement('div');
            questionTypeExplanation.className = 'question-type';
            questionTypeExplanation.textContent = 'Explanation';
            explanation.appendChild(questionTypeExplanation);
            
            // Frage-Titel hinzufügen
            const questionTitleExplanation = document.createElement('div');
            questionTitleExplanation.className = 'question-title';
            questionTitleExplanation.textContent = 'Frage 1';
            explanation.appendChild(questionTitleExplanation);
            
            // Fragetext hinzufügen
            const questionTextExplanation = document.createElement('div');
            questionTextExplanation.className = 'question-text';
            questionTextExplanation.textContent = block.data.question;
            explanation.appendChild(questionTextExplanation);

            const explanationArea = document.createElement('textarea');
            explanationArea.className = "explanation-area";
            explanation.appendChild(explanationArea);
            
            // Button-Container hinzufügen
            explanation.appendChild(createShowButton());
            return explanation;

          default:
            console.warn(`Unsupported block type: ${block.type}`);
            return null;
        }
      }
      
      // Initialize with the data
      renderNote(noteData);
      
      // Add CSS styles for correct and incorrect answers
      const styleSheet = document.createElement("style");
      styleSheet.textContent = `
        .correct-answer {
          color: green;
          font-weight: bold;
        }
        .incorrect-answer {
          color: red;
          text-decoration: line-through;
        }
        .check-mark {
          color: green;
          font-weight: bold;
        }
        .x-mark {
          color: red;
          font-weight: bold;
        }
        .solution-container {
          margin-top: 15px;
          padding: 10px;
          background-color: #f5f5f5;
          border-radius: 5px;
          border-left: 4px solid #4CAF50;
        }
        .solution-text {
          padding: 5px;
        }
      `;
      document.head.appendChild(styleSheet);
      
    } catch (error) {
      console.error("Error processing note data:", error);
      document.getElementById('note-content').innerHTML = '<p>Error loading note content. Please try again later.</p>';
    }
});
</script>

<div id="note-content-data" style="display: none;">
  <%= @course.note.content.to_json.html_safe %>
</div>

<div class="note-container">
  <div id="note-content"></div>   
</div>

