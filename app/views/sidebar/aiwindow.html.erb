  <style>
      

  .small-white-button:hover{
    background-color: #DBDBDB;
  }
.chat-list-item {
    border: none;
    font-size: 14px;
    background-color: transparent;
    width: 100%;
    padding: 0;
    transition: 0.2s ease;
}
  .chat-list-item-active{
    background-color: #FAFAFA;
  }
  .chat-list-item-container:hover{
    background-color: #FAFAFA;
    
  }
  .chat-list-container{
    display: flex;
    flex-direction: column;
  }

  .chat-list-item-container{
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 16px;
    border-radius: 6px;
    gap: 4px;
  }
  .chat-title{
    text-align: left;
    font-size: 1rem;
  }
    .ai-container{
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }
  .ai-chat-buttons{
    display: flex;
    gap: 8px;
    margin-top: 16px;
    margin-bottom: 8px;
    margin-left: auto;
  }
  
  .small-black-button{
    background-color: black;
    padding: 4px;
    cursor: pointer;
    border-radius: 8px;
    width: 33px;
  }
  .ai-chat-container{
    display:flex;
    gap: 16px;
    align-items: center;
    background-color: white;
    border: 1px solid rgb(228, 228, 231);
    padding: 8px;
    border-radius: 8px;
  }
  .ai-inputfield{
    border: none;
    flex-grow: 1;
    outline: none;
    background-color: transparent
  }

  /* ai */
  .dropdown-content {
  position: absolute;
  top: calc(32px + 35px + 16px);
  width: calc(38.46% - 64px - 28px);
  height: calc(100vh - 110px - 64px - 35px - 16px);
  background-color: white;
  border: 1px solid #DBDBDB;
  border-radius: 8px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  z-index: 999;
  
  /* Transition-Eigenschaften hinzufügen */
  opacity: 0;
  transform: translateY(-10px);
  pointer-events: none;
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.dropdown-content.active {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

  
  /* Show the dropdown menu when button is clicked */
  .dropdown-button:focus + .dropdown-content,
  .dropdown-content:hover {
    display: flex;
  }
  
  /* Dropdown header with search */
  .dropdown-header {
    display: flex;
    gap: 8px;
    align-items: center;
    margin: 0 16px;
    padding: 16px 0;
    padding-bottom: 0;
  }
  
  .search-container {
      width: 100%;
      border: 1px solid #e0e0e0;
      display: flex;
      border-radius: 6px;
      height: 30px;
  }
  
  .search-input {
      padding: 7px 7px;
      border-radius: 6px;
      border: none;
      background-color: #ffffff;
      font-size: 14px;
      color: #333;
      outline: none;
      width: 100%;
      transition: box-shadow 0.2s ease, border-color 0.2s ease;
  }
  
  .search-container:focus-within {
    border-color: #d0d0d0;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
}
  
  .search-input::placeholder {
      color: #999;
  }
  
  .search-icon {
      width: 16px;
      height: 16px;
      color: #888;
      
  }
  .search-button {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 6px;
    width: 30px;
    height: 30px;
    border: none;
    box-sizing: border-box;
    flex-shrink: 0;
}
  .search-button:hover{
    background-color:rgba(0, 0, 0, 0.1);
  }

    .dropdown-content-body {
    overflow-y: auto;
    flex-grow: 1;
  }

  .section{
    margin-top: 24px;
  }
  .section-header{
    margin-bottom: 8px;
    font-weight: bold;
  }

  .user-message{
    background-color: #D4ECFF;
    color: black;
    padding: 8px 16px;
    border-radius: 6px;
    border-bottom-right-radius: 0px;
    margin-bottom: 4px;
    margin-left: 24px;
    margin-right: 8px;
    font-size: 16px;
  }
  .ai-message{
    padding: 8px;
    margin-bottom: 16px;
    font-size: 16px;
  }

  
  .size-6{
    height: 20px;
    width: 20px;
  }
  .bookmark-icon{
    display: none;
  }
  .chat-list-item:hover .bookmark-icon {
      display: block;
  }

  .bookmarked{
    display: block;
  }
  .hidden-item{
    display: none;
  }
  .table-of-contents-window{
    display: none;
  }
  .long-white-button{
    display: inline-flex;
    align-items: center;
    background-color: transparent;
    color: black;
    text-decoration: none;
    border-radius: 8px;
    gap: 7px;
    padding: 6px 14px;
    border: 1px solid rgb(228, 228, 231);
    white-space: nowrap; 
    user-select: none;
    max-height: 30px;
  }
  .long-white-button:hover{
    background-color:rgb(244, 244, 245);
  }
  </style>
  <div class="ai-field" style="position: relative; font-size: 1.1rem; height: calc(100% - 135px); overflow-y: auto;"></div>
  
  <div>
    <div class="dropdown-content">
      <div class="dropdown-header">
        <div class="long-white-button bookmark-toggle" id="bookmarksToggle" onclick="onOffButton('bookmark-toggle', 'white', 'black')">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark-icon lucide-bookmark"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>
          <p style="font-size: 14px;">Show Only Bookmarks</p>
        </div>
        <div class="search-container">
          <button class="search-button">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </button>
          <input type="text" class="search-input" placeholder="Search files..." />
        </div>
      </div>
      <div class="dropdown-content-body" style="margin: 16px;">
        <div class="chat-list-container" id="chatListContainer">
          <% 
            today = Date.today
            yesterday = today - 1
            seven_days_ago = today - 7
            
            # Gruppiere AIs nach Datum (unverändert)
            todays_ais = @ais.select { |ai| ai.updated_at.to_date == today }.sort_by { |ai| ai.updated_at }.reverse
            yesterdays_ais = @ais.select { |ai| ai.updated_at.to_date == yesterday }.sort_by { |ai| ai.updated_at }.reverse
            last_week_ais = @ais.select { |ai| ai.updated_at.to_date > seven_days_ago && ai.updated_at.to_date < yesterday }.sort_by { |ai| ai.updated_at }.reverse
            older_ais = @ais.select { |ai| ai.updated_at.to_date <= seven_days_ago }.sort_by { |ai| ai.updated_at }.reverse
            def render_chat_button(ai)
          %>
          <button onclick="openChat(<%= ai.id %>)" class="chat-list-item bookmarkable-item">
            <% user_message = ai.chat.find { |message| message["role"] == "user" } %>
            <% if user_message %>
              <div class="chat-list-item-container">
                <p class="chat-title"><%= user_message["content"].split.first(5).join(" ") %></p>
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  width="20" 
                  height="20" 
                  data-table-name="ai"
                  data-item-id="<%= ai.id %>"
                  viewBox="0 0 24 24" 
                  fill="none" 
                  stroke="currentColor" 
                  stroke-width="2" 
                  stroke-linecap="round" 
                  stroke-linejoin="round" 
                  class="bookmark-icon <%= 'bookmarked' if ai.bookmarked %>"
                  onclick="event.stopPropagation();"
                >
                  <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>
                </svg>                       
              </div>
            <% end %>
          </button>
          <% end %>
          <div id="allAIsSection">
            <div class="section" style="<%= todays_ais.any? ? '' : 'display: none;' %>">
              <p class="section-header">Heute</p>
              <div class="just-added-content"></div>
              <% todays_ais.each do |ai| %>
                <% render_chat_button(ai) %>
              <% end %>
            </div>

            <% if yesterdays_ais.any? %>
              <div class="section">
                <p class="section-header">Gestern</p>
                <% yesterdays_ais.each do |ai| %>
                  <% render_chat_button(ai) %>
                <% end %>
              </div>
            <% end %>

            <% if last_week_ais.any? %>
              <div class="section">
                <p class="section-header">Letzte 7 Tage</p>
                <% last_week_ais.each do |ai| %>
                  <% render_chat_button(ai) %>
                <% end %>
              </div>
            <% end %>

            <% if older_ais.any? %>
              <div class="section">
                <p class="section-header">Älter</p>
                <% older_ais.each do |ai| %>
                  <% render_chat_button(ai) %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="ai-container">
    <div class="ai-chat-buttons">
      <button class="navigation-menu-item" id="create-ai-button">
       <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-icon lucide-plus"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
      </button>
      
      <button class="navigation-menu-item dropdown-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-square-text-icon lucide-message-square-text"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><path d="M13 8H7"/><path d="M17 12H7"/></svg>
      </button>
    </div>
    <div class="ai-chat-container">
      <input class="ai-inputfield" placeholder="Enter Message..."/>
      <button class="small-black-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-arrow-up" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5"/>
        </svg>
      </button>
    </div>
  </div>
